"**":
  # è‡ªå®šä¹‰æŒ‰é’®å¯è§¦å‘çš„äº‹ä»¶ï¼šweb_trigger_*
  web_trigger_build_go_binary:
    - runner:
      services:
        - docker                       # å¯ç”¨ Docker æœåŠ¡ï¼ˆç”¨äº docker build/pushï¼‰
      docker:
        image: golang:1.25.3-trixie    # ä½¿ç”¨å®˜æ–¹ Golang é•œåƒï¼Œç‰ˆæœ¬å›ºå®š
        volumes:
          - /root/.cache/go-build:copy-on-write  # æŒ‚è½½ Go æ„å»ºç¼“å­˜
          - /go:copy-on-write                  # æŒ‚è½½é¡¹ç›®ä¾èµ–ç›®å½•ï¼ˆå¯é€‰ï¼Œæ ¹æ®éœ€è¦ï¼‰
      stages:
        - name: éªŒè¯ make å·¥å…·
          script: make --version
          
        - name: æ„å»ºå¹¶æ¨é€ Docker é•œåƒ
          script: |
            echo "=============================="
            echo "ğŸ”§ å¼€å§‹å¤„ç† web_trigger_build_go_binary"
            echo "=============================="

            # 1. è¾“å‡ºåŸå§‹åŸºæœ¬ä¿¡æ¯
            echo "åŸå§‹ goproxy: $goproxy"
            echo "åŸå§‹ modules: $modules"
            echo "åŸå§‹ archs: $archs"
            echo "åŸå§‹ version: $version"
          
            # 2. å¤„ç† versionï¼šéå¿…å¡«ï¼Œæœªè¾“å…¥åˆ™è‡ªåŠ¨ç”Ÿæˆ
            if [ -z "$version" ]; then
              version="v$(date +%Y%m%d%H%M%S)"
            fi

            # 3. å¦‚æœè¾“å…¥æ²¡æœ‰ v å‰ç¼€ï¼Œè‡ªåŠ¨åŠ ä¸Š
            if ! echo "$version" | grep -qE '^v'; then
              version="v${version}"
            fi
            echo "ä½¿ç”¨ç‰ˆæœ¬å·: $version"

            # 4. å¤„ç† modulesï¼šé€—å·åˆ†éš”æˆç©ºæ ¼ï¼Œå…¼å®¹å•é€‰å’Œå¤šé€‰
            modules=$(echo "$modules" | tr ',' ' ')
            echo "å°†å¤„ç†ä»¥ä¸‹ç±»å‹: $modules"

            # 5. å¤„ç† archsï¼šé€—å·åˆ†éš”æˆç©ºæ ¼ï¼Œå…¼å®¹å•é€‰å’Œå¤šé€‰
            archs=$(echo "$archs" | tr ',' ' ')
            echo "å°†å¤„ç†ä»¥ä¸‹ç±»å‹: $archs"

            # 6. è¾“å‡ºå¤„ç†åçš„åŸºæœ¬ä¿¡æ¯
            echo "å¤„ç†åçš„ goproxy: $goproxy"
            echo "å¤„ç†åçš„ modules: $modules"
            echo "å¤„ç†åçš„ archs: $archs"
            echo "å¤„ç†åçš„ version: $version"
            
            # 7. é…ç½® GOPROXY
            go env -w GO111MODULE=on
            go env -w GOPROXY="$goproxy"

            # 8. ä¸‹è½½ä¾èµ–
            go mod tidy
            go mod vendor

            # 9. åˆ›å»ºbinç›®å½•
            mkdir -p bin
            
            # 10. å¾ªç¯å¤„ç†æ¯ä¸ª module
            for module in $modules; do
              echo "----------------------------------------"
              echo "  å¼€å§‹å¤„ç†æ¨¡å—: $module"

              # 10-1. æ£€æŸ¥ç›®å½•æ˜¯å¦å­˜åœ¨
              if [ ! -d "${module}" ]; then
                echo "é”™è¯¯ï¼šæ¨¡å—ç›®å½•ä¸å­˜åœ¨ï¼Œè·³è¿‡ï¼š${module}"
                continue
              fi

              # 10-2. è¿›å…¥æ¨¡å—ç›®å½•å¹¶ç¼–è¯‘ Go ç¨‹åº
              echo "  ç¼–è¯‘ Go äºŒè¿›åˆ¶..."
              cd "${module}"
              for arch in $archs; do
                if [ "$arch" = "linux_amd64" ]; then
                  GOOS=linux GOARCH=amd64 go build -o "../bin/${module}-linux-amd64" .
                elif [ "$arch" = "linux_arm64" ]; then
                  GOOS=linux GOARCH=arm64 go build -o "../bin/${module}-linux-arm64" .
                fi
              done
              
              # 10-3. è¿”å›é¡¹ç›®æ ¹ç›®å½•ï¼Œé¿å…å½±å“ä¸‹ä¸€ä¸ª type
              cd ..
            done

            echo "=============================="
            echo "ğŸ‰ æ‰€æœ‰ç±»å‹æ„å»º & æ¨é€å®Œæ¯•"
            echo "=============================="

            # 11. é€šè¿‡ set-output è¾“å‡ºåˆ° result
            echo "##[set-output version=$version]"
            echo "##[set-output modules=$modules]"
          exports:
            version: VERSION
            modules: MODULES

        - name: æ‹‰å– Git Tagsï¼ˆç¡®ä¿ changelog èƒ½å·¥ä½œï¼‰
          script: git fetch --tags --unshallow 2>/dev/null || git fetch --tags

        # https://cnb.cool/cnb/plugins/cnbcool/changelog
        - name: ç”Ÿæˆ changelog 
          image: cnbcool/changelog
          exports:
            latestChangeLog: LATEST_CHANGE_LOG

        # https://docs.cnb.cool/zh/build/internal-steps.html#git-release
        - name: åˆ›å»º Release
          type: git:release
          options:
            tag: ${VERSION} 
            title: "${VERSION} - è‡ªåŠ¨æ‰“åŒ… ${MODULES}"
            description: ${LATEST_CHANGE_LOG}
      
        # https://cnb.cool/cnb/plugins/cnbcool/attachments
        - name: ä¸Šä¼  Release é™„ä»¶  
          image: cnbcool/attachments:latest
          settings:
            type: UPLOAD
            tag: ${VERSION} 
            attachments:
              - "./bin/*"
          exports:
            FILES: FILES
      
        - name: è¾“å‡º Release é™„ä»¶ 
          script: echo $FILES